(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{28:function(e,t,n){e.exports={available:"Seat_available__gMd6U",selected:"Seat_selected__3tu3N"}},35:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),a=n(22),r=n.n(a),i=(n(35),n(16)),l=n(3),o=n(8),d=n(23),u=n(4),j=n.n(u),b=n(0);function f(e){var t=e.style,n=e.className,c=e.children,s=e.elevation,a=void 0===s?1:s,r=e.onClick,i=j()("paper-default",n,{"shadow-sm":1===a,shadow:2===a,"shadow-md":3===a,"shadow-lg":4===a,"shadow-xl":5===a,"shadow-2xl":6===a});return Object(b.jsx)("div",{style:t,className:i,onClick:r,children:c})}var m=["children","className","style"];function h(e){var t=e.children,n=e.className,c=e.style,s=Object(d.a)(e,m),a=j()("appBar-default",n);return Object(b.jsx)(f,Object(o.a)(Object(o.a)({style:c,className:a},s),{},{children:t}))}var x=["className","style","imageUrl","children"];function v(e){var t=e.className,n=e.style,c=e.imageUrl,s=e.children,a=Object(d.a)(e,x),r=j()(t);return Object(b.jsxs)(f,Object(o.a)(Object(o.a)({className:r,style:n},a),{},{children:[c&&Object(b.jsx)("div",{className:"h-full w-48 flex-none bg-cover rounded-t lg:rounded-t-none lg:rounded-l text-center overflow-hidden",style:{backgroundImage:"url('".concat(c,"')")}}),s]}))}function O(e){var t=e.className,n=e.style,c=e.movie,s=j()("movieCard-default",t),a=Object(l.f)();return Object(b.jsx)(v,{className:s,style:n,onClick:function(e){a.push("/movie/".concat(c.id))},imageUrl:c.poster,children:Object(b.jsxs)("div",{className:"flex flex-col justify-between p-2 h-full",children:[Object(b.jsxs)("div",{className:"flex flex-col",children:[Object(b.jsx)("div",{className:"text-gray-900 font-bold text-xl mb-2",children:c.title}),Object(b.jsx)("p",{className:"text-gray-700 text-lg text-base",children:c.description}),Object(b.jsxs)("p",{className:"text-gray-500 text-sm text-base",children:["Cast: ",c.cast]}),Object(b.jsxs)("p",{className:"text-gray-500 text-sm text-base",children:["Director: ",c.director]})]}),Object(b.jsxs)("div",{className:"text-right",children:[" ",c.runtime," mins "]})]})})}var p=n(2),g=n(19),y=n(5),N=n.n(y),w=n(11),k=n(10),S="development"===Object({NODE_ENV:"production",PUBLIC_URL:"/movie-ticketing",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENV?{protocol:"http",host:"localhost:8080"}:{protocol:"https",host:"murmuring-wildwood-07967.herokuapp.com"},C=Object(o.a)({},Object(o.a)(Object(o.a)({},{path:"/api/v1"}),S));function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.startsWith("/")&&(e=e.slice(1));var n="".concat(C.protocol,"://").concat(C.host).concat(C.path),c="".concat(n,"/").concat(e);return fetch(c,t).then(function(){var e=Object(w.a)(N.a.mark((function e(t){var n;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=4;break}return e.abrupt("return",t.json());case 4:return e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",Promise.reject(n.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return e}))}function T(){return E.apply(this,arguments)}function E(){return(E=Object(w.a)(N.a.mark((function e(){return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"movie/all",e.abrupt("return",I("movie/all"));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return I("movie/".concat(e))}function P(e,t,n,c){return I("movie/".concat(e,"/slot/").concat(t,"/").concat(n),{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}})}function A(e){return I("ticket/".concat(e))}var D=Object(k.b)("movieService/fetchMovies",Object(w.a)(N.a.mark((function e(){var t;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T();case 3:return t=e.sent,e.abrupt("return",t);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))),R=Object(k.b)("movieService/fetchMovie",function(){var e=Object(w.a)(N.a.mark((function e(t,n){var c,s,a,r,i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.movieId,s=t.refresh,a=void 0!==s&&s,r=n.getState,e.prev=2,M(c)(r())&&!a){e.next=11;break}return e.next=7,_(c);case 7:return i=e.sent,e.abrupt("return",i);case 11:return e.abrupt("return",null);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(2),e.abrupt("return",Promise.reject(e.t0));case 17:case"end":return e.stop()}}),e,null,[[2,14]])})));return function(t,n){return e.apply(this,arguments)}}()),U=Object(k.c)({name:"movieService",initialState:{movies:[],status:"idle"},reducers:{updateSeatAvailability:function(e,t){var n,c=t.payload,s=Object(g.a)(c);try{var a=function(){var t=n.value;e.movies.find((function(e){return e.id===t.movie.id})).slots.find((function(e){return e.id===t.slot.id})).seats.find((function(e){return e.id===t.seat.id})).availability=t.seat.availability};for(s.s();!(n=s.n()).done;)a()}catch(r){s.e(r)}finally{s.f()}}},extraReducers:function(e){e.addCase(D.pending,(function(e){e.status="loading"})).addCase(D.fulfilled,(function(e,t){e.status="idle",e.movies=t.payload})).addCase(D.rejected,(function(e,t){e.status="idle"})).addCase(R.pending,(function(e){e.status="loading"})).addCase(R.fulfilled,(function(e,t){if(e.status="idle",t.payload){var n=t.payload,c=e.movies.findIndex((function(e){return e.id===n.id}));-1===c?e.movies.push(t.payload):(e.movies.splice(c,1),e.movies.push(n))}})).addCase(R.rejected,(function(e,t){e.status="idle"}))}}),W=U.actions.updateSeatAvailability,B=function(e){return e.movieService.movies},M=function(e){return function(t){return t.movieService.movies.find((function(t){return t.id===e}))}},F=function(e){return e.movieService.status},J=U.reducer,H=Object(k.c)({name:"noticeService",initialState:{error:null,warning:null,info:null},reducers:{error:function(e,t){e.error=t.payload},dismissError:function(e){e.error=null},info:function(e,t){e.info=t.payload},dismissInfo:function(e,t){e.info=null}}}),K=H.actions,L=K.error,V=K.dismissError,G=K.info,$=K.dismissInfo,q=function(e){return e.noticeService.error},z=function(e){return e.noticeService.info},Q=H.reducer;function X(e){var t=e.className,n=e.style,s=Object(p.c)(B),a=Object(p.c)(F),r=Object(p.b)(),i=j()("grid gap-4 grid-cols-1 lg:grid-cols-2",t);return Object(c.useEffect)((function(){r(D()).unwrap().then((function(e){e.length||r(G({message:"Server is starting up. Please refresh the page..."}))})).catch((function(e){r(L(e))}))}),[r]),Object(b.jsxs)("div",{className:i,style:n,children:["loading"===a&&Object(b.jsx)("div",{children:"loading..."}),"loading"!==a&&s.map((function(e){return Object(b.jsx)(O,{movie:e},e.id)}))]})}var Y=n(13),Z=(n(47),n(21)),ee=sessionStorage.getItem("user"),te={details:ee?JSON.parse(ee):null,tickets:[],status:"idle",loaded:!1},ne=Object(k.b)("userService/bookTickets",function(){var e=Object(w.a)(N.a.mark((function e(t,n){var c,s,a,r,i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.movieId,s=t.slotId,a=t.userId,r=t.seatIds,n.dispatch,e.prev=2,e.next=5,P(c,s,a,r);case 5:return i=e.sent,e.abrupt("return",i);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",Promise.reject(e.t0));case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()),ce=Object(k.b)("userService/getTickets",function(){var e=Object(w.a)(N.a.mark((function e(t,n){var c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.dispatch,e.prev=1,e.next=4,A(t);case 4:return c=e.sent,e.abrupt("return",c);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()),se=Object(k.c)({name:"userService",initialState:te,reducers:{signIn:function(e){var t={id:"abc"};sessionStorage.setItem("user",JSON.stringify(t)),e.details=t},signOut:function(e){sessionStorage.clear(),e.details=null},addTickets:function(e,t){var n,c=t.payload,s=Object(g.a)(c);try{for(s.s();!(n=s.n()).done;){var a=n.value;e.tickets.push(a)}}catch(r){s.e(r)}finally{s.f()}}},extraReducers:function(e){e.addCase(ne.pending,(function(e){e.status="loading"})).addCase(ne.fulfilled,(function(e,t){var n;e.status="idle",(n=e.tickets).push.apply(n,Object(Z.a)(t.payload))})).addCase(ne.rejected,(function(e,t){e.status="idle"})).addCase(ce.pending,(function(e){e.status="loading"})).addCase(ce.fulfilled,(function(e,t){e.status="idle",e.loaded=!0;var n,c=t.payload,s=Object(g.a)(c);try{var a=function(){var t=n.value;e.tickets.find((function(e){return e.id===t.id}))||e.tickets.push(t)};for(s.s();!(n=s.n()).done;)a()}catch(r){s.e(r)}finally{s.f()}}))}}),ae=se.actions,re=ae.signIn,ie=ae.signOut,le=(ae.addTickets,function(e){return e.user.details}),oe=function(e){return e.user.tickets},de=function(e){return e.user.status},ue=function(e){return e.user.loaded},je=se.reducer,be=function(){var e=Object(l.g)().pathname,t=Object(l.f)(),n=Object(p.b)(),s=Object(c.useState)(!1),a=Object(Y.a)(s,2),r=a[0],i=a[1],o=j()("absolute w-40 bg-white right-0 shadow-md p-2 group-hover:block",{hidden:!r});return Object(b.jsxs)("div",{className:"group relative",children:[Object(b.jsxs)("button",{className:"flex items-center",onClick:function(){i(!r)},children:[Object(b.jsx)("span",{className:"hidden md:inline-block",children:" Welcome back! "}),Object(b.jsx)("div",{className:"rounded-full h-10 w-10 flex items-center justify-center bg-blue-200 ml-2",children:Object(b.jsx)("box-icon",{name:"user",color:"white"})})]}),Object(b.jsxs)("ul",{className:o,children:[Object(b.jsx)("li",{className:"px-3 py-2",children:Object(b.jsxs)("button",{className:"flex items-center justify-between",onClick:function(){t.push("/tickets")},children:[Object(b.jsx)("box-icon",{name:"barcode"}),Object(b.jsx)("span",{className:"ml-2",children:"My Tickets"})]})}),Object(b.jsx)("li",{className:"px-3 py-2 hower:bg-gray-100",children:Object(b.jsxs)("button",{className:"flex items-center justify-between ",onClick:function(){n(ie()),"/tickets"===e&&t.push("/")},children:[Object(b.jsx)("box-icon",{name:"log-out"}),Object(b.jsx)("span",{className:"ml-2 flex-grow",children:"Sign Out"})]})})]})]})},fe=function(){var e=Object(p.b)();return Object(b.jsx)("button",{className:"flex items-center",onClick:function(){e(re())},children:Object(b.jsx)("box-icon",{name:"log-in"})})};function me(e){var t=e.className,n=e.style,c=Object(p.c)(le),s=j()(t);return Object(b.jsx)("div",{className:s,style:n,children:c?Object(b.jsx)(be,{}):Object(b.jsx)(fe,{})})}var he=n(17),xe=n(28),ve=n.n(xe);function Oe(e){var t,n=e.children,c=e.selected,s=e.disabled,a=e.onToggle,r=j()("h-12 md:h-16 lg:h-24 flex justify-center items-center rounded-md",s?"bg-gray-300 cursor-default":"bg-white cursor-pointer",(t={},Object(he.a)(t,ve.a.selected,c&&!s),Object(he.a)(t,ve.a.available,!c),t));return Object(b.jsx)("div",{className:r,onClick:function(e){return s?e.stopPropagation:a(e)},children:n})}function pe(e){var t=Object(l.h)().movieId,n=Object(p.b)(),s=Object(p.c)(le),a=Object(p.c)(M(t)),r=Object(p.c)(F),i=Object(p.c)(de),o=Object(c.useState)([]),d=Object(Y.a)(o,2),u=d[0],m=d[1],h=Object(c.useState)(""),x=Object(Y.a)(h,2),v=x[0],g=x[1],y=Object(c.useState)(""),N=Object(Y.a)(y,2),w=N[0],k=N[1],S=Object(c.useState)([]),C=Object(Y.a)(S,2),I=C[0],T=C[1],E=Object(c.useState)([]),_=Object(Y.a)(E,2),P=_[0],A=_[1],D=Object(c.useState)(0),U=Object(Y.a)(D,2),B=U[0],J=U[1],H=a?a.slots.reduce((function(e,t){var n=t.date;return n in e||(e[n]={}),e[n][t.endTime]=t,e}),{}):{};Object(c.useEffect)((function(){n(R({movieId:t})).unwrap().catch((function(e){return n(L(e))}));var e=Object.keys(H);if(e.length){var c=e[0];g(c);var s=H[c],r=Object.keys(s).map((function(e){return{id:s[e].id,time:e}}));if(T(r),r.length){var i=r[0].id;k(i);var l=a.slots.find((function(e){return e.id===i})).seats;A(l)}}}),[a]);var K=j()("mt-3 border rounded  text-white p-2 text-lg font-medium",u.length&&s&&"loading"!==i?"bg-green-400":"bg-gray-300"),V=j()("text-right text-blue-500",{hidden:s}),G=j()("text-md","font-medium");return Object(b.jsxs)("div",{children:[!a&&"loading"===r&&Object(b.jsx)("div",{children:" loading... "}),a&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("div",{className:"flex",children:[Object(b.jsx)(O,{className:"hidden md:flex flex-grow",movie:a}),Object(b.jsxs)(f,{className:"flex-col p-5 md:w-96 w-full",elevation:1,children:[Object(b.jsx)("div",{className:"w-full mb-2",children:Object(b.jsx)("span",{className:"text-gray-900 font-bold text-xl",children:a.title})}),Object(b.jsxs)("div",{className:"flex flex-col w-full mb-2",children:[Object(b.jsx)("span",{className:G,children:"DATE:"}),Object(b.jsxs)("select",{onChange:function(e){return g(e.target.value)},value:v,children:[Object(b.jsx)("option",{value:"",disabled:!0,children:"select a date"}),Object.keys(H).map((function(e){return Object(b.jsx)("option",{value:e,children:e},e)}))]})]}),Object(b.jsxs)("div",{className:"flex flex-col w-full mb-2",children:[Object(b.jsx)("span",{className:G,children:"TIME:"}),Object(b.jsxs)("select",{onChange:function(e){return k(e.target.value)},value:w,children:[Object(b.jsx)("option",{value:"",disabled:!0,children:"select a time"}),I.map((function(e){return Object(b.jsx)("option",{value:e.id,children:e.time},e.id)}))]})]}),Object(b.jsxs)("div",{className:"flex flex-row w-full mb-2 justify-between",children:[Object(b.jsxs)("div",{className:G,children:[" ",u.length," tickets"]}),Object(b.jsxs)("div",{className:G,children:[" SGD ",B]})]}),Object(b.jsxs)("div",{className:"flex flex-col w-full",children:[Object(b.jsx)("button",{className:K,onClick:function(){var e={movieId:t,slotId:w,userId:s.id,seatIds:u};n(ne(e)).unwrap().then((function(e){n(W(e)),alert("Ticket successfully booked!")})).catch((function(e){n(L(e)),n(R({movieId:t,refresh:!0}))})).finally((function(){m([]),J(0)}))},disabled:!u.length||!s||"loading"===i,children:"Book Now"}),Object(b.jsx)("div",{className:V,children:"Please login to proceed."})]})]})]}),Object(b.jsx)("div",{className:"flex justify-center border my-2 bg-white",children:" screen"}),Object(b.jsx)("div",{className:"grid grid-cols-8 gap-1 md:gap-2 lg:gap-4",children:P.map((function(e){return Object(b.jsx)(Oe,{onToggle:function(t){return function(e,t){var n=t.id,c=u.indexOf(n);-1===c?(m([].concat(Object(Z.a)(u),[n])),J(B+t.price)):(u.splice(c,1),m(Object(Z.a)(u)),J(B-t.price))}(0,e)},selected:-1!==u.indexOf(e.id),disabled:!e.availability,children:e.number},e.id)}))})]})]})}function ge(e){var t=e.className,n=e.style,s=Object(p.b)(),a=Object(p.c)(oe),r=Object(p.c)(le),i=Object(p.c)(de),l=Object(p.c)(ue);Object(c.useEffect)((function(){!l&&r&&(s(V()),s(ce(r.id))),r||s(L({message:"Please login to view tickets"}))}),[r,s]);var o=j()("grid gap-4 grid-cols-1 lg:grid-cols-3 md:grid-cols-2",t);return Object(b.jsxs)("div",{className:o,style:n,children:["loading"===i&&Object(b.jsx)("div",{children:"loading..."}),"idle"===i&&r&&!a.length&&Object(b.jsx)("div",{children:"No ticket available"}),"idle"===i&&a.map((function(e){return Object(b.jsx)(v,{elevation:2,imageUrl:e.movie.poster,children:Object(b.jsxs)("div",{className:"flex flex-col p-2 w-full",children:[Object(b.jsx)("div",{className:"font-bold text-lg",children:e.movie.title}),Object(b.jsx)("div",{className:"text-gray-700 text-lg",children:e.slot.date}),Object(b.jsx)("div",{className:"mb-5 text-gray-700 text-lg",children:e.slot.startTime}),Object(b.jsxs)("div",{className:"text-right font-bold text-xl text-blue-700",children:["Hall ",e.slot.hall," Seat ",e.seat.number]})]})},e.id)}))]})}function ye(e){var t=Object(p.c)(q),n=Object(p.c)(z),c=Object(p.b)(),s=j()("flex justify-center items-center","rounded","p-3","my-2"),a=j()(s,"text-red-500","bg-red-100"),r=j()(s,"text-blue-500","bg-blue-100");return Object(b.jsxs)(b.Fragment,{children:[t&&Object(b.jsxs)("div",{className:a,children:[Object(b.jsx)("span",{className:"flex-grow",children:t.message}),Object(b.jsx)("button",{className:"rounded-full h-6 w-6 bg-white flex justify-center items-center font-bold text-xl",onClick:function(){c(V())},children:Object(b.jsx)("span",{children:"\xd7"})})]}),n&&Object(b.jsxs)("div",{className:r,children:[Object(b.jsx)("span",{className:"flex-grow",children:n.message}),Object(b.jsx)("button",{className:"rounded-full h-6 w-6 bg-white flex justify-center items-center font-bold text-xl",onClick:function(){c($())},children:Object(b.jsx)("span",{children:"\xd7"})})]})]})}var Ne=function(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("span",{className:"font-bold text-3xl text-blue-700",children:"OCB"}),Object(b.jsx)("span",{className:"text-3xl text-blue-500",children:"Cinema"})]})};var we=function(){return Object(b.jsxs)("div",{className:"bg-gray-100 h-screen",children:[Object(b.jsxs)(h,{elevation:3,children:[Object(b.jsx)("div",{className:"flex-grow",children:Object(b.jsx)(i.b,{to:"/",children:Object(b.jsx)(Ne,{})})}),Object(b.jsx)(me,{})]}),Object(b.jsxs)("div",{className:"p-3",children:[Object(b.jsx)(ye,{}),Object(b.jsxs)(l.c,{children:[Object(b.jsx)(l.a,{path:"/movie/:movieId",children:Object(b.jsx)(pe,{})}),Object(b.jsx)(l.a,{path:"/tickets",children:Object(b.jsx)(ge,{})}),Object(b.jsx)(l.a,{path:"/",children:Object(b.jsx)(X,{})})]})]})]})},ke=Object(k.a)({reducer:{user:je,movieService:J,noticeService:Q}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(p.a,{store:ke,children:Object(b.jsx)(i.a,{children:Object(b.jsx)(we,{})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[48,1,2]]]);
//# sourceMappingURL=main.8853de83.chunk.js.map